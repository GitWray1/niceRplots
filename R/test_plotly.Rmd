---
title: "Test plotly themes"
author: "Impact team"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Install and load packages
if (!require(pacman)) install.packages("pacman")
pacman::p_load(tidyverse, plotly)

# Declare location
here::i_am("R/plotly_theme.R")

# Load here package
pacman::p_load(here)

# Load NICE colours
source(here("R", "load_nice_colours.R"))

# Load Plotly themes
source(here("R", "plotly_theme.R"))
```

# Interactive charts

## Plotly

### Styling a Plotly chart

```{r format_plotly, fig.show = "hold", out.width = "50%"}
# Wrangle data for plotting
iris_bar_df <- iris %>% 
  group_by(Species) %>% 
  summarise(Sepal_Width = mean(Sepal.Width)) %>% 
  ungroup()

# Create basic bar chart (left)
plotly_iris_bar <- plot_ly(iris_bar_df,
                    x = ~Species,
                    y = ~Sepal_Width,
                    type = "bar")

# Create formatted chart (right)
plotly_iris_bar_formatted <- plot_ly(iris_bar_df,
                    x = ~Species,
                    y = ~Sepal_Width,
                    type = "bar",
                    marker = list(color = nice_colours[["bold_teal_100"]],
                                  line = list(color = nice_colours[['black_100']], width = 1.5)))

plotly_iris_bar
plotly_iris_bar_formatted

# fig.show = "hold" not working for Plotly?
```

```{r theme_plotly}
plotly_iris_bar_themed <- plotly_iris_bar_formatted %>% 
  nice_plotly_theme(chart_type = "vertical_bar",
             x_title = "Species",
             y_title = "Sepal Width")
```

#### Formatted chart headline title
##### Figure x. Formatted chart statistical title

```{r theme_plotly_output, echo = FALSE}
plotly_iris_bar_themed
```
Alt text (text description of message chart is showing. Mark chart as decorative)  
Source: []  
Download the data for Figure x (CSV, 5.0KB).

### How to save your plot

To download the plot as a static PNG image, click on the camera icon at the top right of the plot.

Saving in other file formats (e.g. .svg or .jpg) is more complicated and requires installation of another piece of software. Read the [Plotly documentation on exporting graphs as static images in R](https://plotly.com/r/static-image-export/).

### Chart types

```{r load_data, message = FALSE, warning = FALSE, eval = FALSE}

# Load in DOACs data
doacs_df <- readr::read_csv(here::here("DOACs_data.csv"),
                              col_types = "Dcccccdddd")

```

#### Histogram

Use chart_type = "horizontal_bar" for histograms.

```{r plotly_histogram}
# Create chart
plotly_hist <- iris %>%
  plot_ly(x = ~Sepal.Width,
          color = ~Species,
          # Use NICE colours - remove colour names so it maps correctly
          colors = unname(nice_palettes[["discrete"]][1:3]),
          type = "histogram",
          # Black outline for bars
          marker = list(line = list(color = nice_colours[['black_100']], width = 1.5)),
          # Set bin width
          xbins = list(size = 0.2,
                       start = 1.9,
                       end = 4.5)) %>% 
  # Stack bars
  layout(barmode = "stack") %>% 
  # Add NICE theme and set axis titles
  nice_plotly_theme(chart_type = "vertical_bar",
             x_title = "Sepal width",
             y_title = "Frequency")

plotly_hist

# Category order differs from ggplot but no big difference

```

# Own tests

```{r}
economics_long %>%
  filter(variable != "pop") %>%
  plot_ly(x = ~date,
         y = ~value01,
         color = ~variable,
         colors = c("#00436C", "#D07B4D", "#000000", "#37906D"),
         type = "scatter",
         mode = "lines") %>%
  nice_plotly_theme(chart_type = "line")
```


```{r}
plot1 <- mpg %>%
  filter(manufacturer %in% c("hyundai", "nissan", "toyota")) %>%
  count(manufacturer) %>%
  plot_ly(y = ~manufacturer,
          x = ~n,
          color = ~manufacturer,
          type = "bar",
          orientation = "h",
          marker = list(line = list(color = '#000000', width = 1.5)))

nice_plotly_theme(plot1, chart_type = "horizontal_bar")
```


```{r}
mpg %>%
  filter(manufacturer %in% c("hyundai", "nissan", "toyota")) %>%
  count(manufacturer) %>%
  plot_ly(y = ~manufacturer,
          x = ~n,
          color = ~manufacturer,
          type = "bar",
          orientation = "h",
          marker = list(line = list(color = '#000000', width = 1.5))) %>%
  nice_plotly_theme(chart_type = "horizontal_bar")
```


```{r}
mpg %>%
  filter(manufacturer %in% c("hyundai", "nissan", "toyota")) %>%
  count(manufacturer) %>%
  plot_ly(x = ~manufacturer,
          y = ~n,
          color = ~manufacturer,
          type = "bar",
          marker = list(line = list(color = '#000000', width = 1.5))) %>%
  nice_plotly_theme(chart_type = "vertical_bar")
```

